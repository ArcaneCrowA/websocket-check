<!doctype html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Inbox Demo - N9S SDK</title>
        <style>
            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    sans-serif;
                margin: 0;
                padding: 20px;
                background: #f5f5f5;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                display: grid;
                grid-template-columns: 400px 1fr;
                gap: 20px;
                background: white;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .controls {
                margin-bottom: 20px;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 6px;
            }
            .controls button {
                margin: 5px;
                padding: 8px 16px;
                border: none;
                border-radius: 4px;
                background: #0d6efd;
                color: white;
                cursor: pointer;
            }
            .controls button:hover {
                background: #0b5ed7;
            }
            .messages-list {
                border-right: 1px solid #dee2e6;
                padding-right: 20px;
                height: 600px;
                overflow-y: auto;
            }
            .message-item {
                padding: 15px;
                border: 1px solid #dee2e6;
                border-radius: 4px;
                margin-bottom: 10px;
                cursor: pointer;
                transition: background-color 0.2s;
            }
            .message-item:hover {
                background-color: #f8f9fa;
            }
            .message-item.unread {
                border-left: 4px solid #0d6efd;
            }
            .message-item .title {
                font-weight: bold;
                margin-bottom: 5px;
            }
            .message-item .date {
                font-size: 0.8em;
                color: #6c757d;
            }
            .message-content {
                padding: 20px;
                height: 600px;
                overflow-y: auto;
            }
            .message-content.empty {
                display: flex;
                align-items: center;
                justify-content: center;
                color: #6c757d;
                font-style: italic;
            }
            .badge {
                display: inline-block;
                padding: 3px 8px;
                border-radius: 10px;
                background: #0d6efd;
                color: white;
                font-size: 0.8em;
            }
        </style>
    </head>
    <body>
        <div class="controls">
            <button onclick="loadMessages()">Load Messages</button>
            <button onclick="getUnreadCount()">Get Unread Count</button>
            <span id="unread-badge" class="badge" style="display: none">0</span>
        </div>

        <div class="container">
            <div class="messages-list" id="messagesList"></div>
            <div class="message-content empty" id="messageContent">
                Выберите сообщение для просмотра
            </div>
        </div>

        <!-- SDK -->
        <script src="/dist/n9s.v1.js"></script>

        <script>
            const config = {
                appId: "app_1234567890abcdef",
            };

            async function loadMessages() {
                try {
                    const result = await window.n9s("inbox.getMessages", {
                        user_id: "user_demo",
                        limit: 20,
                        offset: 0,
                    });

                    const messagesList =
                        document.getElementById("messagesList");
                    messagesList.innerHTML = result.data
                        .map(
                            (message) => `
          <div class="message-item ${message.is_read ? "" : "unread"}" onclick="showMessage('${message.id}')">
            <div class="title">${message.title}</div>
            <div class="content">${message.content}</div>
            <div class="date">${new Date(message.created_at).toLocaleString()}</div>
          </div>
        `,
                        )
                        .join("");
                } catch (error) {
                    console.error("Load messages error:", error);
                }
            }

            async function showMessage(messageId) {
                try {
                    const result = await window.n9s("inbox.getContent", {
                        message_id: messageId,
                    });
                    const messageContent =
                        document.getElementById("messageContent");
                    messageContent.innerHTML = result.html_content;

                    messageContent.classList.remove("empty");

                    await window.n9s("inbox.markAsRead", {
                        message_id: messageId,
                    });

                    const messageItem = document.querySelector(
                        `[onclick="showMessage('${messageId}')"]`,
                    );
                    if (messageItem) messageItem.classList.remove("unread");
                    await getUnreadCount();
                } catch (error) {
                    console.error("Load content error:", error);
                }
            }

            async function getUnreadCount() {
                try {
                    const result = await window.n9s("inbox.getUnreadCount", {
                        user_id: "user_demo",
                    });

                    const badge = document.getElementById("unread-badge");
                    badge.textContent = result.unread_count;
                    badge.style.display =
                        result.unread_count > 0 ? "inline-block" : "none";
                } catch (error) {
                    console.error("Unread count error:", error);
                }
            }
        </script>
    </body>
</html>
